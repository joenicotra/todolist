<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Things 3 Clone - Static Prototype">
    <meta name="theme-color" content="#007AFF">
    <title>Things 3 Clone - Static Prototype</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="favicon.ico">
    <link rel="apple-touch-icon" href="logo192.png">
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="css/design-system.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/views.css">
    
    <!-- Fonts -->
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
    </style>
</head>
<body>
    <!-- Main Application Container -->
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <!-- Smart Lists Section -->
            <div class="sidebar-section">
                <div class="sidebar-item active" data-view="today">
                    <div class="sidebar-icon" style="color: var(--color-orange);">üìÖ</div>
                    <span class="sidebar-text">Today</span>
                    <span class="sidebar-count">3</span>
                </div>
                <div class="sidebar-item" data-view="upcoming">
                    <div class="sidebar-icon" style="color: var(--color-red);">üìÜ</div>
                    <span class="sidebar-text">Upcoming</span>
                    <span class="sidebar-count">7</span>
                </div>
                <div class="sidebar-item" data-view="anytime">
                    <div class="sidebar-icon" style="color: var(--color-teal);">‚≠ê</div>
                    <span class="sidebar-text">Anytime</span>
                    <span class="sidebar-count">12</span>
                </div>
                <div class="sidebar-item" data-view="someday">
                    <div class="sidebar-icon" style="color: var(--color-yellow);">üí≠</div>
                    <span class="sidebar-text">Someday</span>
                    <span class="sidebar-count">5</span>
                </div>
            </div>

            <!-- Separator -->
            <div class="sidebar-separator"></div>

            <!-- Inbox Section -->
            <div class="sidebar-section">
                <div class="sidebar-item" data-view="inbox">
                    <div class="sidebar-icon" style="color: var(--color-blue);">üì•</div>
                    <span class="sidebar-text">Inbox</span>
                    <span class="sidebar-count">2</span>
                </div>
            </div>

            <!-- Separator -->
            <div class="sidebar-separator"></div>

            <!-- Areas & Projects Section -->
            <div class="sidebar-section">
                <div class="sidebar-header">
                    <span>Areas</span>
                </div>
                <div class="sidebar-item" data-view="work-area">
                    <div class="sidebar-icon area-icon">üíº</div>
                    <span class="sidebar-text">Work</span>
                    <span class="sidebar-count">8</span>
                </div>
                <div class="sidebar-item" data-view="personal-area">
                    <div class="sidebar-icon area-icon">üè†</div>
                    <span class="sidebar-text">Personal</span>
                    <span class="sidebar-count">4</span>
                </div>
            </div>

            <!-- Separator -->
            <div class="sidebar-separator"></div>

            <!-- Archive Section -->
            <div class="sidebar-section">
                <div class="sidebar-item" data-view="logbook">
                    <div class="sidebar-icon" style="color: var(--color-green);">üìö</div>
                    <span class="sidebar-text">Logbook</span>
                </div>
                <div class="sidebar-item" data-view="trash">
                    <div class="sidebar-icon" style="color: var(--color-gray-dark);">üóëÔ∏è</div>
                    <span class="sidebar-text">Trash</span>
                </div>
            </div>

            <!-- New List Button -->
            <div class="sidebar-footer">
                <div class="dropdown-wrapper">
                    <button class="btn-new-list" id="new-list-btn">
                        <span class="plus-icon">+</span>
                        <span>New List</span>
                    </button>
                    <div class="dropdown-menu" id="new-list-dropdown">
                        <div class="dropdown-item" data-type="area">
                            <span class="dropdown-icon">üìÅ</span>
                            <div class="dropdown-content">
                                <div class="dropdown-title">New Area</div>
                                <div class="dropdown-subtitle">A collection of projects</div>
                            </div>
                        </div>
                        <div class="dropdown-item" data-type="project">
                            <span class="dropdown-icon">üìã</span>
                            <div class="dropdown-content">
                                <div class="dropdown-title">New Project</div>
                                <div class="dropdown-subtitle">A list of related to-dos</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Today View (Default Active) -->
            <div class="view-container active" id="today-view">
                <header class="view-header">
                    <button class="mobile-menu-toggle" id="mobile-menu-toggle">‚ò∞</button>
                    <h1 class="view-title">Today</h1>
                    <div class="view-actions">
                        <button class="btn-ghost">‚öôÔ∏è</button>
                    </div>
                </header>

                <div class="view-content">
                    <!-- Calendar Events Section -->
                    <section class="calendar-events">
                        <h2 class="section-title">Calendar</h2>
                        <div class="calendar-event">
                            <div class="event-time">9:00 AM</div>
                            <div class="event-title">Team Standup</div>
                        </div>
                        <div class="calendar-event">
                            <div class="event-time">2:00 PM</div>
                            <div class="event-title">Project Review</div>
                        </div>
                    </section>

                    <!-- Today Tasks Section -->
                    <section class="tasks-section">
                        <h2 class="section-title">Today</h2>
                        <div class="task-list">
                            <div class="task-card">
                                <div class="task-checkbox"></div>
                                <div class="task-content">
                                    <div class="task-title">Review quarterly goals</div>
                                    <div class="task-notes">Check progress on Q4 objectives and plan for next quarter</div>
                                </div>
                            </div>
                            <div class="task-card">
                                <div class="task-checkbox"></div>
                                <div class="task-content">
                                    <div class="task-title">Update project documentation</div>
                                </div>
                            </div>
                            <div class="task-card completed">
                                <div class="task-checkbox checked"></div>
                                <div class="task-content">
                                    <div class="task-title">Morning workout</div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- This Evening Section -->
                    <section class="tasks-section">
                        <h2 class="section-title">This Evening</h2>
                        <div class="task-list">
                            <div class="task-card">
                                <div class="task-checkbox"></div>
                                <div class="task-content">
                                    <div class="task-title">Plan tomorrow's priorities</div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Quick Add Section -->
                    <div class="quick-add-section">
                        <div class="quick-add-hint">Press Ctrl+Shift+N to create a new to-do</div>
                    </div>
                </div>
            </div>

            <!-- Other Views (Hidden by default) -->
            <div class="view-container" id="inbox-view">
                <header class="view-header">
                    <h1 class="view-title">Inbox</h1>
                </header>
                <div class="view-content">
                    <div class="empty-state">
                        <div class="empty-state-icon">üì•</div>
                        <div class="empty-state-title">Your Inbox is empty</div>
                        <div class="empty-state-subtitle">New tasks you create will appear here</div>
                    </div>
                </div>
            </div>

            <!-- Upcoming View -->
            <div class="view-container" id="upcoming-view">
                <header class="view-header">
                    <h1 class="view-title">Upcoming</h1>
                </header>
                <div class="view-content">
                    <div class="date-group">
                        <div class="date-group-header overdue">Overdue</div>
                        <div class="task-list">
                            <div class="task-card">
                                <div class="task-checkbox"></div>
                                <div class="task-content">
                                    <div class="task-title">Submit expense report</div>
                                    <div class="task-notes">Due 2 days ago</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="date-group">
                        <div class="date-group-header tomorrow">Tomorrow</div>
                        <div class="task-list">
                            <div class="task-card">
                                <div class="task-checkbox"></div>
                                <div class="task-content">
                                    <div class="task-title">Team meeting preparation</div>
                                </div>
                            </div>
                            <div class="task-card">
                                <div class="task-checkbox"></div>
                                <div class="task-content">
                                    <div class="task-title">Review design mockups</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="date-group">
                        <div class="date-group-header">This Week</div>
                        <div class="task-list">
                            <div class="task-card">
                                <div class="task-checkbox"></div>
                                <div class="task-content">
                                    <div class="task-title">Plan Q1 objectives</div>
                                </div>
                            </div>
                            <div class="task-card">
                                <div class="task-checkbox"></div>
                                <div class="task-content">
                                    <div class="task-title">Update portfolio website</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Anytime View -->
            <div class="view-container" id="anytime-view">
                <header class="view-header">
                    <h1 class="view-title">Anytime</h1>
                </header>
                <div class="view-content">
                    <div class="project-group">
                        <div class="project-group-header">
                            <div class="project-icon"></div>
                            <div class="project-group-title">Work Projects</div>
                        </div>
                        <div class="task-list">
                            <div class="task-card">
                                <div class="task-checkbox"></div>
                                <div class="task-content">
                                    <div class="task-title">Research new frameworks</div>
                                </div>
                            </div>
                            <div class="task-card">
                                <div class="task-checkbox"></div>
                                <div class="task-content">
                                    <div class="task-title">Optimize database queries</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="project-group">
                        <div class="project-group-header">
                            <div class="project-icon progress"></div>
                            <div class="project-group-title">Personal Development</div>
                        </div>
                        <div class="task-list">
                            <div class="task-card">
                                <div class="task-checkbox"></div>
                                <div class="task-content">
                                    <div class="task-title">Complete online course</div>
                                </div>
                            </div>
                            <div class="task-card">
                                <div class="task-checkbox"></div>
                                <div class="task-content">
                                    <div class="task-title">Read industry articles</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Someday View -->
            <div class="view-container" id="someday-view">
                <header class="view-header">
                    <h1 class="view-title">Someday</h1>
                </header>
                <div class="view-content">
                    <div class="area-group">
                        <div class="area-group-header">
                            <div class="sidebar-icon">üíº</div>
                            <div class="area-group-title">Work</div>
                        </div>
                        <div class="task-list">
                            <div class="task-card">
                                <div class="task-checkbox"></div>
                                <div class="task-content">
                                    <div class="task-title">Learn new programming language</div>
                                </div>
                            </div>
                            <div class="task-card">
                                <div class="task-checkbox"></div>
                                <div class="task-content">
                                    <div class="task-title">Attend tech conference</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="area-group">
                        <div class="area-group-header">
                            <div class="sidebar-icon">üè†</div>
                            <div class="area-group-title">Personal</div>
                        </div>
                        <div class="task-list">
                            <div class="task-card">
                                <div class="task-checkbox"></div>
                                <div class="task-content">
                                    <div class="task-title">Plan vacation trip</div>
                                </div>
                            </div>
                            <div class="task-card">
                                <div class="task-checkbox"></div>
                                <div class="task-content">
                                    <div class="task-title">Redecorate home office</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Logbook View -->
            <div class="view-container" id="logbook-view">
                <header class="view-header">
                    <h1 class="view-title">Logbook</h1>
                </header>
                <div class="view-content">
                    <section class="tasks-section">
                        <h2 class="section-title">Today</h2>
                        <div class="task-list">
                            <div class="completed-task">
                                <div class="task-card completed">
                                    <div class="task-checkbox checked"></div>
                                    <div class="task-content">
                                        <div class="task-title">Morning workout</div>
                                        <div class="completion-date">Completed at 7:30 AM</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <section class="tasks-section">
                        <h2 class="section-title">Yesterday</h2>
                        <div class="task-list">
                            <div class="completed-task">
                                <div class="task-card completed">
                                    <div class="task-checkbox checked"></div>
                                    <div class="task-content">
                                        <div class="task-title">Review code changes</div>
                                        <div class="completion-date">Completed at 4:15 PM</div>
                                    </div>
                                </div>
                            </div>
                            <div class="completed-task">
                                <div class="task-card completed">
                                    <div class="task-checkbox checked"></div>
                                    <div class="task-content">
                                        <div class="task-title">Send project update</div>
                                        <div class="completion-date">Completed at 2:30 PM</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
            </div>

            <!-- Trash View -->
            <div class="view-container" id="trash-view">
                <header class="view-header">
                    <h1 class="view-title">Trash</h1>
                </header>
                <div class="view-content">
                    <div class="empty-state">
                        <div class="empty-state-icon">üóëÔ∏è</div>
                        <div class="empty-state-title">Trash is empty</div>
                        <div class="empty-state-subtitle">Deleted tasks will appear here</div>
                    </div>
                </div>
            </div>

            <!-- Work Area View -->
            <div class="view-container" id="work-area-view">
                <header class="view-header">
                    <h1 class="view-title">Work</h1>
                </header>
                <div class="view-content">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number">8</div>
                            <div class="stat-label">Active Tasks</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">3</div>
                            <div class="stat-label">Projects</div>
                        </div>
                    </div>

                    <div class="project-group">
                        <div class="project-group-header">
                            <div class="project-icon progress"></div>
                            <div class="project-group-title">Website Redesign</div>
                        </div>
                        <div class="task-list">
                            <div class="task-card">
                                <div class="task-checkbox"></div>
                                <div class="task-content">
                                    <div class="task-title">Create wireframes</div>
                                </div>
                            </div>
                            <div class="task-card">
                                <div class="task-checkbox"></div>
                                <div class="task-content">
                                    <div class="task-title">Design system documentation</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Personal Area View -->
            <div class="view-container" id="personal-area-view">
                <header class="view-header">
                    <h1 class="view-title">Personal</h1>
                </header>
                <div class="view-content">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number">4</div>
                            <div class="stat-label">Active Tasks</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">2</div>
                            <div class="stat-label">Projects</div>
                        </div>
                    </div>

                    <div class="project-group">
                        <div class="project-group-header">
                            <div class="project-icon"></div>
                            <div class="project-group-title">Home Improvement</div>
                        </div>
                        <div class="task-list">
                            <div class="task-card">
                                <div class="task-checkbox"></div>
                                <div class="task-content">
                                    <div class="task-title">Paint living room</div>
                                </div>
                            </div>
                            <div class="task-card">
                                <div class="task-checkbox"></div>
                                <div class="task-content">
                                    <div class="task-title">Install new shelves</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Magic Plus Button -->
        <button class="magic-plus-btn">
            <span class="plus-icon">+</span>
        </button>

        <!-- Bottom Toolbar -->
        <div class="bottom-toolbar">
            <button class="toolbar-btn" id="projects-btn" title="Projects">üìã</button>
            <button class="toolbar-btn" id="search-btn" title="Search">üîç</button>
            <button class="toolbar-btn" id="settings-btn" title="Settings">‚öôÔ∏è</button>
        </div>

        <!-- Task Creation Modal removed - now using inline editing -->

        <!-- Context Menu -->
        <div class="context-menu" id="context-menu">
            <div class="context-menu-item" data-action="edit">
                <span class="context-icon">‚úèÔ∏è</span>
                <span>Edit</span>
            </div>
            <div class="context-menu-item" data-action="duplicate">
                <span class="context-icon">üìã</span>
                <span>Duplicate</span>
            </div>
            <div class="context-menu-separator"></div>
            <div class="context-menu-item" data-action="move-to-today">
                <span class="context-icon">üìÖ</span>
                <span>Move to Today</span>
            </div>
            <div class="context-menu-item" data-action="move-to-upcoming">
                <span class="context-icon">üìÜ</span>
                <span>Move to Upcoming</span>
            </div>
            <div class="context-menu-separator"></div>
            <div class="context-menu-item" data-action="delete">
                <span class="context-icon">üóëÔ∏è</span>
                <span>Delete</span>
            </div>
        </div>

        <!-- Notification Toast -->
        <div class="toast" id="notification-toast">
            <div class="toast-content">
                <span class="toast-icon">‚úì</span>
                <span class="toast-message">Task completed!</span>
            </div>
        </div>

        <!-- Search Overlay -->
        <div class="search-overlay" id="search-overlay">
            <div class="search-container">
                <div class="search-header">
                    <input type="text" class="search-input" id="search-input" placeholder="Search tasks, projects, and areas..." autofocus>
                    <button class="search-close" id="search-close">√ó</button>
                </div>
                <div class="search-results" id="search-results">
                    <div class="search-section">
                        <div class="search-section-title">Tasks</div>
                        <div class="search-result-item">
                            <div class="search-result-icon">‚òê</div>
                            <div class="search-result-content">
                                <div class="search-result-title">Review design mockups</div>
                                <div class="search-result-subtitle">Tomorrow ‚Ä¢ Work</div>
                            </div>
                        </div>
                        <div class="search-result-item">
                            <div class="search-result-icon">‚òê</div>
                            <div class="search-result-content">
                                <div class="search-result-title">Plan Q1 objectives</div>
                                <div class="search-result-subtitle">This Week ‚Ä¢ Work</div>
                            </div>
                        </div>
                    </div>
                    <div class="search-section">
                        <div class="search-section-title">Projects</div>
                        <div class="search-result-item">
                            <div class="search-result-icon">üìã</div>
                            <div class="search-result-content">
                                <div class="search-result-title">Website Redesign</div>
                                <div class="search-result-subtitle">Work ‚Ä¢ 2 tasks</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Panel -->
        <div class="settings-panel" id="settings-panel">
            <div class="settings-content">
                <div class="settings-header">
                    <h3 class="settings-title">Settings</h3>
                    <button class="settings-close" id="settings-close">√ó</button>
                </div>
                <div class="settings-body">
                    <div class="settings-section">
                        <h4 class="settings-section-title">Appearance</h4>
                        <div class="settings-option">
                            <label class="settings-label">
                                <input type="checkbox" class="settings-checkbox" checked>
                                <span>Dark mode</span>
                            </label>
                        </div>
                        <div class="settings-option">
                            <label class="settings-label">
                                <input type="checkbox" class="settings-checkbox">
                                <span>Compact view</span>
                            </label>
                        </div>
                    </div>
                    <div class="settings-section">
                        <h4 class="settings-section-title">Notifications</h4>
                        <div class="settings-option">
                            <label class="settings-label">
                                <input type="checkbox" class="settings-checkbox" checked>
                                <span>Desktop notifications</span>
                            </label>
                        </div>
                        <div class="settings-option">
                            <label class="settings-label">
                                <input type="checkbox" class="settings-checkbox" checked>
                                <span>Sound effects</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sidebar Overlay for Mobile -->
        <div class="sidebar-overlay" id="sidebar-overlay"></div>
    </div>

    <!-- JavaScript for enhanced interactions -->
    <script>
        // Basic view switching
        document.querySelectorAll('.sidebar-item').forEach(item => {
            item.addEventListener('click', function() {
                // Remove active class from all sidebar items
                document.querySelectorAll('.sidebar-item').forEach(i => i.classList.remove('active'));
                // Add active class to clicked item
                this.classList.add('active');

                // Hide all views
                document.querySelectorAll('.view-container').forEach(view => view.classList.remove('active'));

                // Show corresponding view
                const viewName = this.dataset.view;
                const viewElement = document.getElementById(viewName + '-view');
                if (viewElement) {
                    viewElement.classList.add('active');
                }
            });
        });

        // Task checkbox interactions with animation
        document.querySelectorAll('.task-checkbox').forEach(checkbox => {
            checkbox.addEventListener('click', function(e) {
                e.stopPropagation();
                const taskCard = this.closest('.task-card');
                const wasCompleted = taskCard.classList.contains('completed');

                taskCard.classList.toggle('completed');
                this.classList.toggle('checked');

                // Show notification
                if (!wasCompleted) {
                    showNotification('Task completed!', 'success');
                    // Add completion animation
                    taskCard.style.transform = 'scale(0.98)';
                    setTimeout(() => {
                        taskCard.style.transform = 'scale(1)';
                    }, 150);
                } else {
                    showNotification('Task reopened', 'info');
                }
            });
        });

        // Magic plus button interactions - Create inline task
        const magicBtn = document.querySelector('.magic-plus-btn');

        if (magicBtn) {
            magicBtn.addEventListener('click', function() {
                createInlineTask();
            });

            magicBtn.addEventListener('mouseenter', function() {
                this.style.transform = 'scale(1.05)';
            });

            magicBtn.addEventListener('mouseleave', function() {
                this.style.transform = 'scale(1)';
            });
        }

        // Create inline task function
        function createInlineTask() {
            const activeView = document.querySelector('.view-container.active');
            if (!activeView) return;

            // Find the appropriate task list in the active view
            let taskList = activeView.querySelector('.task-list');
            if (!taskList) {
                // If no task list exists, create one
                const viewContent = activeView.querySelector('.view-content');
                if (viewContent) {
                    taskList = document.createElement('div');
                    taskList.className = 'task-list';
                    viewContent.appendChild(taskList);
                }
            }

            if (taskList) {
                // Create new task card with inline editing
                const newTaskCard = document.createElement('div');
                newTaskCard.className = 'task-card editing new-task';
                newTaskCard.innerHTML = `
                    <div class="task-checkbox"></div>
                    <div class="task-content">
                        <input type="text" class="task-title-edit" placeholder="What do you want to do?" autofocus>
                        <div class="task-edit-actions">
                            <button class="btn-save-task">Save</button>
                            <button class="btn-cancel-task">Cancel</button>
                        </div>
                    </div>
                `;

                // Insert at the top of the task list
                taskList.insertBefore(newTaskCard, taskList.firstChild);

                // Focus the input
                const input = newTaskCard.querySelector('.task-title-edit');
                input.focus();

                // Add event listeners for save/cancel
                setupInlineTaskEditing(newTaskCard);
            }
        }

        // Context-aware task creation for keyboard shortcut
        function createContextAwareTask() {
            const activeView = document.querySelector('.view-container.active');
            const currentViewId = activeView ? activeView.id : '';

            // Check if we're in Logbook or Trash - if so, route to Inbox
            if (currentViewId === 'logbook-view' || currentViewId === 'trash-view') {
                // Switch to inbox view
                document.querySelectorAll('.sidebar-item').forEach(item => item.classList.remove('active'));
                document.querySelectorAll('.view-container').forEach(view => view.classList.remove('active'));

                const inboxItem = document.querySelector('.sidebar-item[data-view="inbox"]');
                const inboxView = document.getElementById('inbox-view');

                if (inboxItem && inboxView) {
                    inboxItem.classList.add('active');
                    inboxView.classList.add('active');

                    // Show notification about where task was created
                    showNotification('Task added to Inbox', 'info');

                    // Create task in inbox after a brief delay for view transition
                    setTimeout(() => {
                        createInlineTask();
                    }, 100);
                }
            } else {
                // Create task in current view
                createInlineTask();

                // Show notification about where task was created
                const viewName = getCurrentViewName();
                if (viewName) {
                    showNotification(`Task added to ${viewName}`, 'info');
                }
            }
        }

        // Helper function to get current view name
        function getCurrentViewName() {
            const activeView = document.querySelector('.view-container.active');
            if (!activeView) return null;

            const viewId = activeView.id;
            const viewNames = {
                'today-view': 'Today',
                'upcoming-view': 'Upcoming',
                'anytime-view': 'Anytime',
                'someday-view': 'Someday',
                'inbox-view': 'Inbox',
                'logbook-view': 'Logbook',
                'trash-view': 'Trash',
                'work-area-view': 'Work',
                'personal-area-view': 'Personal'
            };

            return viewNames[viewId] || null;
        }

        // Setup inline task editing
        function setupInlineTaskEditing(taskCard) {
            const input = taskCard.querySelector('.task-title-edit');
            const saveBtn = taskCard.querySelector('.btn-save-task');
            const cancelBtn = taskCard.querySelector('.btn-cancel-task');

            function saveTask() {
                const title = input.value.trim();
                if (title) {
                    // Convert to regular task card
                    taskCard.className = 'task-card';
                    taskCard.innerHTML = `
                        <div class="task-checkbox"></div>
                        <div class="task-content">
                            <div class="task-title">${title}</div>
                        </div>
                    `;

                    // Add checkbox functionality
                    const checkbox = taskCard.querySelector('.task-checkbox');
                    checkbox.addEventListener('click', function(e) {
                        e.stopPropagation();
                        taskCard.classList.toggle('completed');
                        this.classList.toggle('checked');
                        showNotification(taskCard.classList.contains('completed') ? 'Task completed!' : 'Task reopened', 'success');
                    });

                    // Add context menu
                    taskCard.addEventListener('contextmenu', function(e) {
                        e.preventDefault();
                        currentTask = this;
                        const contextMenu = document.getElementById('context-menu');
                        contextMenu.style.left = e.pageX + 'px';
                        contextMenu.style.top = e.pageY + 'px';
                        contextMenu.classList.add('active');
                    });

                    showNotification('Task created!', 'success');
                } else {
                    cancelTask();
                }
            }

            function cancelTask() {
                taskCard.remove();
            }

            // Event listeners
            saveBtn.addEventListener('click', saveTask);
            cancelBtn.addEventListener('click', cancelTask);

            // Save on Enter, cancel on Escape
            input.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    saveTask();
                } else if (e.key === 'Escape') {
                    e.preventDefault();
                    cancelTask();
                }
            });
        }

        // Modal interactions removed - now using inline task creation

        // Context menu for tasks
        const contextMenu = document.getElementById('context-menu');
        let currentTask = null;

        document.querySelectorAll('.task-card').forEach(task => {
            task.addEventListener('contextmenu', function(e) {
                e.preventDefault();
                currentTask = this;

                contextMenu.style.left = e.pageX + 'px';
                contextMenu.style.top = e.pageY + 'px';
                contextMenu.classList.add('active');
            });
        });

        // Hide context menu on click outside
        document.addEventListener('click', function() {
            contextMenu.classList.remove('active');
        });

        // Context menu actions
        document.querySelectorAll('.context-menu-item').forEach(item => {
            item.addEventListener('click', function() {
                const action = this.dataset.action;
                if (currentTask) {
                    handleContextAction(action, currentTask);
                }
                contextMenu.classList.remove('active');
            });
        });

        function handleContextAction(action, task) {
            switch(action) {
                case 'edit':
                    showNotification('Edit mode activated', 'info');
                    break;
                case 'duplicate':
                    showNotification('Task duplicated', 'success');
                    break;
                case 'move-to-today':
                    showNotification('Moved to Today', 'success');
                    break;
                case 'move-to-upcoming':
                    showNotification('Moved to Upcoming', 'success');
                    break;
                case 'delete':
                    task.style.opacity = '0';
                    task.style.transform = 'translateX(-100%)';
                    setTimeout(() => {
                        task.remove();
                        showNotification('Task deleted', 'info');
                    }, 300);
                    break;
            }
        }

        // Notification system
        function showNotification(message, type = 'info') {
            const toast = document.getElementById('notification-toast');
            const toastMessage = toast.querySelector('.toast-message');
            const toastIcon = toast.querySelector('.toast-icon');

            toastMessage.textContent = message;

            // Set icon based on type
            switch(type) {
                case 'success':
                    toastIcon.textContent = '‚úì';
                    break;
                case 'error':
                    toastIcon.textContent = '‚ö†Ô∏è';
                    break;
                case 'info':
                    toastIcon.textContent = '‚ÑπÔ∏è';
                    break;
            }

            toast.classList.add('active');

            setTimeout(() => {
                toast.classList.remove('active');
            }, 3000);
        }

        // Bottom Toolbar Functionality
        const projectsBtn = document.getElementById('projects-btn');
        const searchBtn = document.getElementById('search-btn');
        const settingsBtn = document.getElementById('settings-btn');
        const searchOverlay = document.getElementById('search-overlay');
        const settingsPanel = document.getElementById('settings-panel');
        const searchClose = document.getElementById('search-close');
        const settingsClose = document.getElementById('settings-close');
        const searchInput = document.getElementById('search-input');

        // Projects button - show all projects view
        if (projectsBtn) {
            projectsBtn.addEventListener('click', function() {
                showNotification('Projects view coming soon!', 'info');
                // TODO: Implement projects overview
            });
        }

        // Search functionality
        if (searchBtn && searchOverlay) {
            searchBtn.addEventListener('click', function() {
                searchOverlay.classList.add('active');
                searchInput.focus();
            });
        }

        if (searchClose) {
            searchClose.addEventListener('click', function() {
                searchOverlay.classList.remove('active');
                searchInput.value = '';
            });
        }

        // Settings functionality
        if (settingsBtn && settingsPanel) {
            settingsBtn.addEventListener('click', function() {
                settingsPanel.classList.add('active');
            });
        }

        if (settingsClose) {
            settingsClose.addEventListener('click', function() {
                settingsPanel.classList.remove('active');
            });
        }

        // Close overlays on escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                searchOverlay.classList.remove('active');
                settingsPanel.classList.remove('active');
            }
        });

        // Close overlays on background click
        searchOverlay.addEventListener('click', function(e) {
            if (e.target === searchOverlay) {
                searchOverlay.classList.remove('active');
            }
        });

        settingsPanel.addEventListener('click', function(e) {
            if (e.target === settingsPanel) {
                settingsPanel.classList.remove('active');
            }
        });

        // Search functionality
        if (searchInput) {
            searchInput.addEventListener('input', function() {
                const query = this.value.toLowerCase();
                const results = document.getElementById('search-results');

                if (query.length > 0) {
                    // Simple search simulation
                    results.style.display = 'block';
                    // In a real app, this would filter actual data
                } else {
                    results.style.display = 'none';
                }
            });
        }

        // Enhanced keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Skip if user is typing in an input field
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
                return;
            }

            // Ctrl + Shift + N for context-aware new task (avoiding dead key issues)
            if (e.ctrlKey && e.shiftKey && (e.key === 'n' || e.key === 'N')) {
                e.preventDefault();
                createContextAwareTask();
            }

            // Cmd/Ctrl + K for search
            if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
                e.preventDefault();
                searchBtn.click();
            }

            // Cmd/Ctrl + , for settings
            if ((e.metaKey || e.ctrlKey) && e.key === ',') {
                e.preventDefault();
                settingsBtn.click();
            }
        });

        // Task hover effects
        document.querySelectorAll('.task-card').forEach(task => {
            task.addEventListener('mouseenter', function() {
                this.style.backgroundColor = 'rgba(0,122,255,0.05)';
            });

            task.addEventListener('mouseleave', function() {
                this.style.backgroundColor = '';
            });
        });

        // New List Dropdown
        const newListBtn = document.getElementById('new-list-btn');
        const newListDropdown = document.getElementById('new-list-dropdown');

        if (newListBtn && newListDropdown) {
            newListBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                newListDropdown.classList.toggle('active');
            });

            // Handle dropdown item clicks
            newListDropdown.querySelectorAll('.dropdown-item').forEach(item => {
                item.addEventListener('click', function() {
                    const type = this.dataset.type;
                    newListDropdown.classList.remove('active');

                    if (type === 'area') {
                        createInlineArea();
                    } else if (type === 'project') {
                        createInlineProject();
                    }
                });
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', function() {
                newListDropdown.classList.remove('active');
            });
        }

        // Create inline area function
        function createInlineArea() {
            // Find the areas section by looking for the "Areas" text
            let areasSection = null;
            const sidebarSections = document.querySelectorAll('.sidebar-section');
            for (const section of sidebarSections) {
                const headerSpan = section.querySelector('.sidebar-header span');
                if (headerSpan && headerSpan.textContent.includes('Areas')) {
                    areasSection = section;
                    break;
                }
            }
            // Fallback to last section if Areas section not found
            if (!areasSection) {
                areasSection = document.querySelector('.sidebar-section:last-of-type');
            }

            if (!areasSection) return;

            // Generate unique ID for the area
            const areaId = 'area-' + Date.now();

            // Create new area item in sidebar
            const newAreaItem = document.createElement('div');
            newAreaItem.className = 'sidebar-item editing';
            newAreaItem.dataset.view = areaId + '-view';
            newAreaItem.innerHTML = `
                <div class="sidebar-icon area-icon">üìÅ</div>
                <input type="text" class="sidebar-text-edit" placeholder="New Area" autofocus>
                <span class="sidebar-count">0</span>
            `;

            // Insert the new area item
            areasSection.appendChild(newAreaItem);

            // Create corresponding view
            createAreaView(areaId, 'New Area');

            // Setup inline editing for the sidebar item
            setupSidebarItemEditing(newAreaItem, 'area');

            // Switch to the new area view
            switchToView(newAreaItem);
        }

        // Create inline project function
        function createInlineProject() {
            // Find the current active area or default location
            const activeAreaItem = document.querySelector('.sidebar-item.active[data-view*="area"]');

            // Find the areas section by looking for the "Areas" text
            let targetSection = null;
            const sidebarSections = document.querySelectorAll('.sidebar-section');
            for (const section of sidebarSections) {
                const headerSpan = section.querySelector('.sidebar-header span');
                if (headerSpan && headerSpan.textContent.includes('Areas')) {
                    targetSection = section;
                    break;
                }
            }
            // Fallback to last section if Areas section not found
            if (!targetSection) {
                targetSection = document.querySelector('.sidebar-section:last-of-type');
            }

            // Generate unique ID for the project
            const projectId = 'project-' + Date.now();

            // Create new project item in sidebar
            const newProjectItem = document.createElement('div');
            newProjectItem.className = 'sidebar-item editing project-item';
            newProjectItem.dataset.view = projectId + '-view';
            newProjectItem.innerHTML = `
                <div class="sidebar-icon project-icon">üìã</div>
                <input type="text" class="sidebar-text-edit" placeholder="New Project" autofocus>
                <span class="sidebar-count">0</span>
            `;

            // If we have an active area, insert the project after it (nested)
            if (activeAreaItem) {
                newProjectItem.classList.add('nested-project');
                activeAreaItem.insertAdjacentElement('afterend', newProjectItem);
            } else {
                targetSection.appendChild(newProjectItem);
            }

            // Create corresponding view
            createProjectView(projectId, 'New Project');

            // Setup inline editing for the sidebar item
            setupSidebarItemEditing(newProjectItem, 'project');

            // Switch to the new project view
            switchToView(newProjectItem);
        }

        // Create area view
        function createAreaView(areaId, areaName) {
            const mainContent = document.querySelector('.main-content');
            const newView = document.createElement('div');
            newView.className = 'view-container';
            newView.id = areaId + '-view';
            newView.innerHTML = `
                <div class="view-header">
                    <h1 class="view-title editable-title" data-type="area">${areaName}</h1>
                    <div class="view-actions">
                        <button class="btn-icon" title="Area Options">‚ãØ</button>
                    </div>
                </div>
                <div class="view-content">
                    <div class="area-notes editable-notes" data-placeholder="Add notes about this area..."></div>
                    <div class="task-list"></div>
                </div>
            `;

            mainContent.appendChild(newView);

            // Setup click-to-edit for title and notes
            setupEditableContent(newView);
        }

        // Create project view
        function createProjectView(projectId, projectName) {
            const mainContent = document.querySelector('.main-content');
            const newView = document.createElement('div');
            newView.className = 'view-container';
            newView.id = projectId + '-view';
            newView.innerHTML = `
                <div class="view-header">
                    <h1 class="view-title editable-title" data-type="project">${projectName}</h1>
                    <div class="view-actions">
                        <button class="btn-icon" title="Project Options">‚ãØ</button>
                    </div>
                </div>
                <div class="view-content">
                    <div class="project-notes editable-notes" data-placeholder="Add notes about this project..."></div>
                    <div class="task-list"></div>
                </div>
            `;

            mainContent.appendChild(newView);

            // Setup click-to-edit for title and notes
            setupEditableContent(newView);
        }

        // Setup sidebar item editing
        function setupSidebarItemEditing(sidebarItem, type) {
            const input = sidebarItem.querySelector('.sidebar-text-edit');
            const icon = sidebarItem.querySelector('.sidebar-icon');

            if (!input) return;

            function saveItem() {
                const newName = input.value.trim();
                if (newName) {
                    // Replace input with span
                    const span = document.createElement('span');
                    span.className = 'sidebar-text';
                    span.textContent = newName;
                    input.replaceWith(span);

                    // Update the corresponding view title
                    const viewId = sidebarItem.dataset.view;
                    const view = document.getElementById(viewId);
                    if (view) {
                        const viewTitle = view.querySelector('.view-title');
                        if (viewTitle) viewTitle.textContent = newName;
                    }

                    // Remove editing class
                    sidebarItem.classList.remove('editing');

                    // Show success notification
                    showNotification(`${type.charAt(0).toUpperCase() + type.slice(1)} "${newName}" created!`, 'success');
                } else {
                    cancelItem();
                }
            }

            function cancelItem() {
                // Remove the item and its view
                const viewId = sidebarItem.dataset.view;
                const view = document.getElementById(viewId);
                if (view) view.remove();
                sidebarItem.remove();
            }

            // Event listeners
            input.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    saveItem();
                } else if (e.key === 'Escape') {
                    e.preventDefault();
                    cancelItem();
                }
            });

            input.addEventListener('blur', saveItem);
        }

        // Setup editable content (titles and notes)
        function setupEditableContent(viewElement) {
            const editableTitle = viewElement.querySelector('.editable-title');
            const editableNotes = viewElement.querySelector('.editable-notes');

            // Setup title editing
            if (editableTitle) {
                editableTitle.addEventListener('click', function() {
                    if (this.classList.contains('editing')) return;

                    const currentText = this.textContent;
                    this.classList.add('editing');

                    const input = document.createElement('input');
                    input.type = 'text';
                    input.className = 'title-edit-input';
                    input.value = currentText;

                    this.innerHTML = '';
                    this.appendChild(input);
                    input.focus();
                    input.select();

                    function saveTitle() {
                        const newTitle = input.value.trim();
                        if (newTitle) {
                            editableTitle.textContent = newTitle;
                            editableTitle.classList.remove('editing');

                            // Update sidebar text
                            const viewId = viewElement.id;
                            const sidebarItem = document.querySelector(`[data-view="${viewId}"]`);
                            if (sidebarItem) {
                                const sidebarText = sidebarItem.querySelector('.sidebar-text');
                                if (sidebarText) sidebarText.textContent = newTitle;
                            }
                        } else {
                            editableTitle.textContent = currentText;
                            editableTitle.classList.remove('editing');
                        }
                    }

                    function cancelTitle() {
                        editableTitle.textContent = currentText;
                        editableTitle.classList.remove('editing');
                    }

                    input.addEventListener('keydown', function(e) {
                        if (e.key === 'Enter') {
                            e.preventDefault();
                            saveTitle();
                        } else if (e.key === 'Escape') {
                            e.preventDefault();
                            cancelTitle();
                        }
                    });

                    input.addEventListener('blur', saveTitle);
                });
            }

            // Setup notes editing
            if (editableNotes) {
                // Show placeholder when empty
                if (!editableNotes.textContent.trim()) {
                    editableNotes.classList.add('empty');
                    editableNotes.textContent = editableNotes.dataset.placeholder || 'Add notes...';
                }

                editableNotes.addEventListener('click', function() {
                    if (this.classList.contains('editing')) return;

                    const currentText = this.classList.contains('empty') ? '' : this.textContent;
                    this.classList.add('editing');
                    this.classList.remove('empty');

                    const textarea = document.createElement('textarea');
                    textarea.className = 'notes-edit-textarea';
                    textarea.value = currentText;
                    textarea.placeholder = this.dataset.placeholder || 'Add notes...';

                    this.innerHTML = '';
                    this.appendChild(textarea);
                    textarea.focus();

                    // Auto-resize textarea
                    function autoResize() {
                        textarea.style.height = 'auto';
                        textarea.style.height = textarea.scrollHeight + 'px';
                    }

                    textarea.addEventListener('input', autoResize);
                    autoResize();

                    function saveNotes() {
                        const newNotes = textarea.value.trim();
                        editableNotes.classList.remove('editing');

                        if (newNotes) {
                            editableNotes.textContent = newNotes;
                        } else {
                            editableNotes.classList.add('empty');
                            editableNotes.textContent = editableNotes.dataset.placeholder || 'Add notes...';
                        }
                    }

                    function cancelNotes() {
                        editableNotes.classList.remove('editing');
                        if (currentText) {
                            editableNotes.textContent = currentText;
                        } else {
                            editableNotes.classList.add('empty');
                            editableNotes.textContent = editableNotes.dataset.placeholder || 'Add notes...';
                        }
                    }

                    textarea.addEventListener('keydown', function(e) {
                        if (e.key === 'Escape') {
                            e.preventDefault();
                            cancelNotes();
                        }
                        // Allow Cmd/Ctrl+Enter to save
                        if ((e.metaKey || e.ctrlKey) && e.key === 'Enter') {
                            e.preventDefault();
                            saveNotes();
                        }
                    });

                    textarea.addEventListener('blur', saveNotes);
                });
            }
        }

        // Switch to view helper
        function switchToView(sidebarItem) {
            // Remove active class from all sidebar items
            document.querySelectorAll('.sidebar-item').forEach(item => item.classList.remove('active'));
            // Add active class to clicked item
            sidebarItem.classList.add('active');

            // Hide all views
            document.querySelectorAll('.view-container').forEach(view => view.classList.remove('active'));

            // Show corresponding view
            const viewName = sidebarItem.dataset.view;
            const viewElement = document.getElementById(viewName);
            if (viewElement) {
                viewElement.classList.add('active');
            }
        }

        // Mobile Menu Toggle
        const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
        const sidebar = document.querySelector('.sidebar');
        const sidebarOverlay = document.getElementById('sidebar-overlay');

        if (mobileMenuToggle && sidebar) {
            mobileMenuToggle.addEventListener('click', function() {
                sidebar.classList.toggle('open');
                document.body.classList.toggle('sidebar-open');
            });

            // Close sidebar when clicking on overlay
            if (sidebarOverlay) {
                sidebarOverlay.addEventListener('click', function() {
                    sidebar.classList.remove('open');
                    document.body.classList.remove('sidebar-open');
                });
            }

            // Close sidebar when clicking on main content on mobile
            document.querySelector('.main-content').addEventListener('click', function() {
                if (window.innerWidth <= 768) {
                    sidebar.classList.remove('open');
                    document.body.classList.remove('sidebar-open');
                }
            });
        }

        // Enhanced responsive behavior
        function handleResize() {
            if (window.innerWidth > 768) {
                sidebar.classList.remove('open');
                document.body.classList.remove('sidebar-open');
            }
        }

        window.addEventListener('resize', handleResize);

        // Smooth scrolling for sidebar
        document.querySelectorAll('.sidebar-item').forEach(item => {
            item.addEventListener('click', function() {
                // Smooth scroll to top of main content
                document.querySelector('.main-content').scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            });
        });

        // Auto-save functionality simulation
        let autoSaveTimeout;
        function simulateAutoSave() {
            clearTimeout(autoSaveTimeout);
            autoSaveTimeout = setTimeout(() => {
                // Simulate auto-save
                console.log('Auto-saving...');
            }, 2000);
        }

        // Add auto-save to input fields
        document.querySelectorAll('input, textarea').forEach(input => {
            input.addEventListener('input', simulateAutoSave);
        });

        // Progressive enhancement for animations
        if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
            document.documentElement.style.setProperty('--transition-fast', '0ms');
            document.documentElement.style.setProperty('--transition-normal', '0ms');
            document.documentElement.style.setProperty('--transition-slow', '0ms');
        }

        // Initialize app
        function initializeApp() {
            // Set initial focus
            if (window.innerWidth > 768) {
                document.body.classList.add('desktop');
            }

            // Add loading complete class
            setTimeout(() => {
                document.body.classList.add('loaded');
            }, 100);
        }

        // Run initialization when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeApp);
        } else {
            initializeApp();
        }
    </script>
</body>
</html>
